<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="GENERATOR" content="Quadralay WebWorks Publisher Professional Edition 7.0.2.1128" />
    <meta name="TEMPLATEBASE" content="book-no-index" />
    <meta name="LASTUPDATED" content="Mon Jan 27 15:22:44 2003" />
    <title>Object Input Classes</title>
	<link rel="StyleSheet" href="document.css" type="text/css" />
	<link rel="StyleSheet" href="catalog.css" type="text/css" />
    <link rel="Table of Contents" href="serialTOC.html" />
    <link rel="Previous" href="output.html" />
    <link rel="Next" href="class.html" />
    <link rel="Index" href="examples.html" />
  </head>

  <body>
<a href="#skip" title="Skip navigation bar"></a>
    <table width="100%" summary="layout">
      <tr><td align="left">
        <a accesskey="c" href="serialTOC.html">Contents</a> | 
	<a accesskey="p" href="output.html">Previous</a> | 
        <a accesskey="n" href="class.html">Next</a>
       </td>
	   <td align="right"><i>Java<font size="-2"><sup>TM</sup></font> Object Serialization Specification</i></td>
      </tr>
    </table>
<hr size="8" width="35%" align="left" noshade>
<a name="skip"></a>
<a name="wp60"> </a><h2 class="pNewHTMLPage">
Object Input Classes
</h2>
<hr class="pHr"/>
<a name="wp64"> </a><h2 class="pChapNum">
Chapter &#160; 1
</h2>
<a name="wp883"> </a><h4 class="pHeading3">
		Topics:
</h4>
<ul class="pBullet1"><a name="wp2983"> </a><div class="pBullet1"><li><a  href="input.html#wp961">The ObjectInputStream Class</a></li></div>
<a name="wp5224"> </a><div class="pBullet1Plus"><li><a  href="input.html#wp4936">The ObjectInputStream.GetField Class</a></li></div>
<a name="wp2984"> </a><div class="pBullet1Plus"><li><a  href="input.html#wp3403">The ObjectInputValidation Interface</a></li></div>
<a name="wp5887"> </a><div class="pBullet1Plus"><li><a  href="input.html#wp2971">The readObject Method</a></li></div>
<a name="wp3424"> </a><div class="pBullet1Plus"><li><a  href="input.html#wp6014">The readExternal Method</a></li></div>
<a name="wp5919"> </a><div class="pBullet1Last"><li><a  href="input.html#wp5903">The readResolve Method</a></li></div>
</ul>
<a name="wp961"> </a><h2 class="pHeading1">
	1.1	The ObjectInputStream Class
</h2>
<a name="wp1162"> </a><p class="pBody">
Class <code class="cCode">ObjectInputStream</code> implements object deserialization. It maintains the state of the stream including the set of objects already deserialized. Its methods allow primitive types and objects to be read from a stream written by <code class="cCode">ObjectOutputStream</code>. It manages restoration of the object and the objects that it refers to from the stream.
</p>
<div class="pPreformatted"><pre class="pPreformatted">
package java.io;

public class ObjectInputStream
    extends InputStream
    implements ObjectInput, ObjectStreamConstants
{
    public ObjectInputStream(InputStream in)
        throws StreamCorruptedException, IOException;

    public final Object readObject()
        throws OptionalDataException, ClassNotFoundException, 
            IOException;

    public Object readUnshared()
        throws OptionalDataException, ClassNotFoundException, 
            IOException;

    public void defaultReadObject()
        throws IOException, ClassNotFoundException,
            NotActiveException;

    public GetField readFields()
        throws IOException;

    public synchronized void registerValidation(
        ObjectInputValidation obj, int prio)
        throws NotActiveException, InvalidObjectException;

    protected ObjectStreamClass readClassDescriptor()
        throws IOException, ClassNotFoundException;

    protected Class resolveClass(ObjectStreamClass v)
        throws IOException, ClassNotFoundException;

    protected Object resolveObject(Object obj)
        throws IOException;

    protected boolean enableResolveObject(boolean enable)
        throws SecurityException;

    protected void readStreamHeader()
        throws IOException, StreamCorruptedException;

    public int read() throws IOException;

    public int read(byte[] data, int offset, int length)
        throws IOException

    public int available() throws IOException;

    public void close() throws IOException;

    public boolean readBoolean() throws IOException;

    public byte readByte() throws IOException;

    public int readUnsignedByte() throws IOException;

    public short readShort() throws IOException;

    public int readUnsignedShort() throws IOException;

    public char readChar() throws IOException;

    public int readInt() throws IOException;

    public long readLong() throws IOException;

    public float readFloat() throws IOException;

    public double readDouble() throws IOException;

    public void readFully(byte[] data) throws IOException;

    public void readFully(byte[] data, int offset, int size)
        throws IOException;

    public int skipBytes(int len) throws IOException;

    public String readLine() throws IOException;

    public String readUTF() throws IOException;

    // Class to provide access to serializable fields.
    static abstract public class GetField
    {
        public ObjectStreamClass getObjectStreamClass();

        public boolean defaulted(String name)
            throws IOException, IllegalArgumentException;

        public char get(String name, char default)
            throws IOException, IllegalArgumentException;

        public boolean get(String name, boolean default)
            throws IOException, IllegalArgumentException;

        public byte get(String name, byte default)
            throws IOException, IllegalArgumentException;

        public short get(String name, short default)
            throws IOException, IllegalArgumentException;

        public int get(String name, int default)
            throws IOException, IllegalArgumentException;

        public long get(String name, long default)
            throws IOException, IllegalArgumentException;

        public float get(String name, float default)
            throws IOException, IllegalArgumentException;

        public double get(String name, double default)
            throws IOException, IllegalArgumentException;

        public Object get(String name, Object default)
            throws IOException, IllegalArgumentException;
    }

    protected ObjectInputStream()
        throws StreamCorruptedException, IOException;

    protected readObjectOverride()
        throws OptionalDataException, ClassNotFoundException,
            IOException;
}
</pre></div>
<a name="wp1168"> </a><p class="pBody">
The single-argument <code class="cCode">ObjectInputStream</code> constructor requires an <code class="cCode">InputStream</code>. The constructor calls <code class="cCode">readStreamHeader</code> to read and verifies the header and version written by the corresponding <code class="cCode">ObjectOutputStream.writeStreamHeader</code> method.  If a security manager is installed, this constructor checks for the <code class="cCode">&#8220;enableSubclassImplementation&#8221;</code> <code class="cCode">SerializablePermission</code> when invoked directly or indirectly by the constructor of a subclass which overrides the <code class="cCode">readFields</code> and/or <code class="cCode">readUnshared</code> methods.
</p>
<hr class="pHr"/><div class="note">
<a name="wp5998"> </a>
<b>Note &#8211;</b>  The <code class="cCode">ObjectInputStream</code> constructor blocks until it completes reading the serialization stream header.  Code which waits for an <code class="cCode">ObjectInputStream</code> to be constructed before creating the corresponding <code class="cCode">ObjectOutputStream</code> for that stream will deadlock, since the <code class="cCode">ObjectInputStream</code> constructor will block until a header is written to the stream, and the header will not be written to the stream until the <code class="cCode">ObjectOutputStream</code> constructor executes.  This problem can be resolved by creating the <code class="cCode">ObjectOutputStream</code> before the <code class="cCode">ObjectInputStream</code>, or otherwise removing the timing dependency between completion of <code class="cCode">ObjectInputStream</code> construction and the creation of the <code class="cCode">ObjectOutputStream</code>.
<hr class="pHr"/></note>
<a name="wp1169"> </a><p class="pBody">
The <code class="cCode">readObject</code> method is used to deserialize an object from the stream. It reads from the stream to reconstruct an object.
</p>
<div class="pStep1">
<ol class="pStep1"><a name="wp5509"> </a><li>If the <code class="cCode">ObjectInputStream</code> subclass is overriding the implementation, <br />call the <code class="cCode">readObjectOverride</code> method and return. Reimplementation is described at the end of this section. </li>
<a name="wp5512"> </a><li>If a block data record occurs in the stream, throw a <code class="cCode">BlockDataException</code> with the number of available bytes.</li>
<a name="wp4418"> </a><li>If the object in the stream is null, return null.</li>
<a name="wp5328"> </a><li>If the object in the stream is a handle to a previous object, return the object.</li>
<a name="wp5330"> </a><li>If the object in the stream is a <code class="cCode">Class</code>, read its <code class="cCode">ObjectStreamClass</code> descriptor, add it and its handle to the set of known objects, and return the corresponding <code class="cCode">Class</code> object.</li>
<a name="wp3491"> </a><li>If the object in the stream is an <code class="cCode">ObjectStreamClass</code>, read its name, <code class="cCode">serialVersionUID</code>, and fields. Add it and its handle to the set of known objects. Call the <code class="cCode">resolveClass</code> method on the stream to get the local class for this descriptor, and throw an exception if the class cannot be found. Return the <code class="cCode">ObjectStreamClass</code> object.</li>
<a name="wp5334"> </a><li>If the object in the stream is a String, read its UTF encoding, add it and its handle to the set of known objects, and proceed to Step 11.</li>
<a name="wp3492"> </a><li>If the object in the stream is an array, read its <code class="cCode">ObjectStreamClass</code> and the length of the array. Allocate the array, and add it and its handle in the set of known objects. Read each element using the appropriate method for its type and assign it to the array. Proceed to Step 11.</li>
<a name="wp3483"> </a><li>For all other objects, the <code class="cCode">ObjectStreamClass</code> of the object is read from the stream. The local class for that <code class="cCode">ObjectStreamClass</code> is retrieved. The class must be serializable or externalizable.</li>
<a name="wp4917"> </a><li>An instance of the class is allocated. The instance and its handle are added to the set of known objects. The contents restored appropriately:</li>
<div class="pStep2">
<ol class="pStep2"><a name="wp4918"> </a><li type="a">For serializable objects, the no-arg constructor for the first non-serializable supertype is run. For serializable classes, the fields are initialized to the default value appropriate for its type. Then the fields of each class are restored by calling class-specific <code class="cCode">readObject</code> methods, or if these are not defined, by calling the <code class="cCode">defaultReadObject</code> method. Note that field initializers and constructors are not executed for serializable classes during deserialization. In the normal case, the version of the class that wrote the stream will be the same as the class reading the stream. In this case, all of the supertypes of the object in the stream will match the supertypes in the currently-loaded class. If the version of the class that wrote the stream had different supertypes than the loaded class, the <code class="cCode">ObjectInputStream</code> must be more careful about restoring or initializing the state of the differing classes. It must step through the classes, matching the available data in the stream with the classes of the object being restored. Data for classes that occur in the stream, but do not occur in the object, is discarded. For classes that occur in the object, but not in the stream, the class fields are set to default values by default serialization.</li>
<a name="wp3584"> </a><li type="a">For externalizable objects, the no-arg constructor for the class is run and then the <code class="cCode">readExternal</code> method is called to restore the contents of the object.</li>
</ol>
<a name="wp5072"> </a><li>Process potential substitutions by the class of the object and/or by a subclass of <code class="cCode">ObjectInputStream</code><code class="cCode">:</code> </li>
<div class="pStep2">
<ol class="pStep2"><a name="wp5078"> </a><li type="a">If the class of the object defines the appropriate <code class="cCode">readResolve</code> method, the method is called to allow the object to replace itself.</li>
<a name="wp5079"> </a><li type="a">Then if previously enabled by <code class="cCode">enableResolveObject,</code> the <code class="cCode">resolveObject</code> method is called to allow subclasses of the stream to examine and replace the object. If the previous step did replace the original object, the <code class="cCode">resolveObject</code> method is called with the replacement object.</li>
<a name="wp5080"> </a><p class="pBody">
</ol></ol>
If a replacement took place, the table of known objects is updated so the replacement object is associated with the handle. The replacement object is then returned from <code class="cCode">readObject</code>.
</p>
<a name="wp3621"> </a><p class="pBody">
All of the methods for reading primitives types only consume bytes from the block data records in the stream. If a read for primitive data occurs when the next item in the stream is an object, the read methods return <code class="cCode">-1</code> or the <code class="cCode">EOFException</code> as appropriate. The value of a primitive type is read by a <code class="cCode">DataInputStream</code> from the block data record.
</p>
<a name="wp4427"> </a><p class="pBody">
The exceptions thrown reflect errors during the traversal or exceptions that occur on the underlying stream. If any exception is thrown, the underlying stream is left in an unknown and unusable state.
</p>
<a name="wp4563"> </a><p class="pBody">
When the reset token occurs in the stream, all of the state of the stream is discarded. The set of known objects is cleared.
</p>
<a name="wp4564"> </a><p class="pBody">
When the exception token occurs in the stream, the exception is read and a new <code class="cCode">WriteAbortedException</code> is thrown with the terminating exception as an argument. The stream context is reset as described earlier.
</p>
<a name="wp3502"> </a><p class="pBody">
The <code class="cCode">readUnshared</code> method is used to read &#8220;unshared&#8221; objects from the stream.  This method is identical to <code class="cCode">readObject</code>, except that it prevents subsequent calls to <code class="cCode">readObject</code> and <code class="cCode">readUnshared</code> from returning additional references to the deserialized instance returned by the original call to <code class="cCode">readUnshared</code>.  Specifically:
</p>
<ul class="pBullet1"><a name="wp6120"> </a><div class="pBullet1"><li>If <code class="cCode">readUnshared</code> is called to deserialize a back-reference (the stream representation of an object which has been written previously to the stream), an <code class="cCode">ObjectStreamException</code> will be thrown.</li></div>
<a name="wp6139"> </a><div class="pBullet1Last"><li>If <code class="cCode">readUnshared</code> returns successfully, then any subsequent attempts to deserialize back-references to the stream handle deserialized by <code class="cCode">readUnshared</code> will cause an <code class="cCode">ObjectStreamException</code> to be thrown.</li></div>
</ul>
<a name="wp6140"> </a><p class="pBody">
Deserializing an object via <code class="cCode">readUnshared</code> invalidates the stream handle associated with the returned object.  Note that this in itself does not always guarantee that the reference returned by <code class="cCode">readUnshared</code> is unique; the deserialized object may define a <code class="cCode">readResolve</code> method which returns an object visible to other parties, or <code class="cCode">readUnshared</code> may return a <code class="cCode">Class</code> object obtainable elsewhere in the stream or through external means.  However, for objects which are not instances of <code class="cCode">java.lang.Class</code> and do not define <code class="cCode">readResolve</code> methods, <code class="cCode">readUnshared</code> guarantees that the returned object reference is unique and cannot be obtained a second time from the <code class="cCode">ObjectInputStream</code> that created it, even if the underlying data stream has been manipulated.  This guarantee applies only to the base-level object returned by <code class="cCode">readUnshared</code>, and not to any transitively referenced sub-objects in the returned object graph.
</p>
<a name="wp6141"> </a><p class="pBody">
The <code class="cCode">defaultReadObject</code> method is used to read the fields and object from the stream. It uses the class descriptor in the stream to read the fields in the canonical order by name and type from the stream. The values are assigned to the matching fields by name in the current class. Details of the versioning mechanism can be found in <a  href="version.html#wp6519">Section&#160;5.5 &quot;Compatible Java&#8482; Type Evolution</a>.&#8221; Any field of the object that does not appear in the stream is set to its default value. Values that appear in the stream, but not in the object, are discarded. This occurs primarily when a later version of a class has written additional fields that do not occur in the earlier version. This method may only be called from the <code class="cCode">readObject</code> method while restoring the fields of a class. When called at any other time, the <code class="cCode">NotActiveException</code> is thrown.
</p>
<a name="wp4979"> </a><p class="pBody">
The <code class="cCode">readFields</code> method reads the values of the serializable fields from the stream and makes them available via the <code class="cCode">GetField</code> class. The <code class="cCode">readFields</code> method is only callable from within the <code class="cCode">readObject</code> method of a serializable class. It cannot be called more than once or if <code class="cCode">defaultReadObject</code> has been called. The <code class="cCode">GetFields</code> object uses the current object&#8217;s <code class="cCode">ObjectStreamClass</code> to verify the fields that can be retrieved for this class. The <code class="cCode">GetFields</code> object returned by <code class="cCode">readFields</code> is only valid during this call to the classes <code class="cCode">readObject</code> method. The fields may be retrieved in any order. Additional data may only be read directly from stream after <code class="cCode">readFields</code> has been called.
</p>
<a name="wp1302"> </a><p class="pBody">
The <code class="cCode">registerValidation</code> method can be called to request a callback when the entire graph has been restored but before the object is returned to the original caller of <code class="cCode">readObject</code>. The order of validate callbacks can be controlled using the priority. Callbacks registered with higher values are called before those with lower values. The object to be validated must support the <code class="cCode">ObjectInputValidation</code> interface and implement the <code class="cCode">validateObject</code> method. It is only correct to register validations during a call to a class&#8217;s <code class="cCode">readObject</code> method. Otherwise, a <code class="cCode">NotActiveException</code> is thrown. If the callback object supplied to <code class="cCode">registerValidation</code> is null, an <code class="cCode">InvalidObjectException</code> is thrown.
</p>
<a name="wp5994"> </a><p class="pBody">
Starting with the Java&#8482; SDK, Standard Edition, v1.3, the <code class="cCode">readClassDescriptor</code> method is used to read in all <code class="cCode">ObjectStreamClass</code> objects.  <code class="cCode">readClassDescriptor</code> is called when the <code class="cCode">ObjectInputStream</code> expects a class descriptor as the next item in the serialization stream.  Subclasses of <code class="cCode">ObjectInputStream</code> may override this method to read in class descriptors that have been written in non-standard formats (by subclasses of <code class="cCode">ObjectOutputStream</code> which have overridden the <code class="cCode">writeClassDescriptor</code> method).  By default, this method reads class descriptors according to the format described in <a  href="protocol.html#wp10258">Section&#160;6.4 &quot;Grammar for the Stream Format</a>&#8221;.
</p>
<a name="wp1194"> </a><p class="pBody">
The <code class="cCode">resolveClass</code> method is called while a class is being deserialized, and after the class descriptor has been read. Subclasses may extend this method to read other information about the class written by the corresponding subclass of <code class="cCode">ObjectOutputStream</code>. The method must find and return the class with the given name and <code class="cCode">serialVersionUID</code>. The default implementation locates the class by calling the class loader of the closest caller of <code class="cCode">readObject</code> that has a class loader. If the class cannot be found <code class="cCode">ClassNotFoundException</code> should be thrown. Prior to JDK&#8482; 1.1.6, the <code class="cCode">resolveClass</code> method was required to return the same fully qualified class name as the class name in the stream. In order to accommodate package renaming across releases, <code class="cCode">method</code> <code class="cCode">resolveClass</code> only needs to return a class with the same base class name and <code class="cCode">SerialVersionUID</code> in JDK&#8482; 1.1.6 and later versions. 
</p>
<a name="wp5264"> </a><p class="pBody">
The <code class="cCode">resolveObject</code> method is used by trusted subclasses to monitor or substitute one object for another during deserialization. Resolving objects must be enabled explicitly by calling <code class="cCode">enableResolveObject</code> before calling <code class="cCode">readObject</code> for the first object to be resolved. Once enabled, <code class="cCode">resolveObject</code> is called once for each serializable object just prior to the first time it is being returned from <code class="cCode">readObject</code>. Note that the <code class="cCode">resolveObject</code> method is not called for objects of the specially handled classes, <code class="cCode">Class</code>, <code class="cCode">ObjectStreamClass</code>, <code class="cCode">String</code>, and arrays. A subclass&#8217;s implementation of <code class="cCode">resolveObject</code> may return a substitute object that will be assigned or returned instead of the original. The object returned must be of a type that is consistent and assignable to every reference of the original object or else a <code class="cCode">ClassCastException</code> will be thrown. All assignments are type-checked. All references in the stream to the original object will be replaced by references to the substitute object.
</p>
<a name="wp5120"> </a><p class="pBody">
The <code class="cCode">enableResolveObject</code> method is called by trusted subclasses of <code class="cCode">ObjectOutputStream</code> to enable the monitoring or substitution of one object for another during deserialization. Replacing objects is disabled until <code class="cCode">enableResolveObject</code> is called with a <em style="font-style: oblique" class="cEmphasis">true</em> value. It may thereafter be disabled by setting it to <em style="font-style: oblique" class="cEmphasis">false</em>. The previous setting is returned. The <code class="cCode">enableResolveObject</code> method checks if the stream has permission to request substitution during serialization. To ensure that the private state of objects is not unintentionally exposed, only trusted streams may use <code class="cCode">resolveObject</code>. Trusted classes are those classes with a class loader equal to null or belong to a security protection domain that provides permission to enable substitution.
</p>
<a name="wp5521"> </a><p class="pBody">
If the subclass of <code class="cCode">ObjectInputStream</code> is not considered part of the system domain, a line has to be added to the security policy file to provide to a subclass of <code class="cCode">ObjectInputStream </code>permission to call <code class="cCode">enableResolveObject</code>. The <code class="cCode">SerializablePermission</code> to add is <code class="cCode">&#8220;enableSubstitution&#8221;</code>. <code class="cCode">AccessControlException</code> is thrown if the protection domain of the subclass of <code class="cCode">ObjectStreamClass</code> does not have permission to <code class="cCode">&#8220;enableSubstitution&#8221;</code> by calling <code class="cCode">enableResolveObject</code>. See the document Java&#8482; Security Architecture (JDK&#8482; 1.2) for additional information about the security model.
</p>
<a name="wp5059"> </a><p class="pBody">
The <code class="cCode">readStreamHeader</code> method reads and verifies the magic number and version of the stream. If they do not match, the <code class="cCode">StreamCorruptedMismatch</code> is thrown.
</p>
<a name="wp5506"> </a><p class="pBody">
To override the implementation of deserialization, a subclass of <code class="cCode">ObjectInputStream</code> should call the protected no-arg <code class="cCode">ObjectInputStream</code>, constructor. There is a security check within the no-arg constructor for <code class="cCode">SerializablePermission &#8220;enableSubclassImplementation&#8221;</code> to ensure that only trusted classes are allowed to override the default implementation. This constructor does not allocate any private data for <code class="cCode">ObjectInputStream</code> and sets a flag that indicates that the final <code class="cCode">readObject</code> method should invoke the <code class="cCode">readObjectOverride</code> method and return. All other <code class="cCode">ObjectInputStream</code> methods are not final and can be directly overridden by the subclass.
</p>
<a name="wp4936"> </a><h2 class="pHeading1">
	1.2	The ObjectInputStream.GetField Class
</h2>
<a name="wp5058"> </a><p class="pBody">
The class <code class="cCode">ObjectInputStream.GetField</code> provides the API for getting the values of serializable fields. The protocol of the stream is the same as used by <code class="cCode">defaultReadObject.</code> Using <code class="cCode">readFields</code> to access the serializable fields does not change the format of the stream. It only provides an alternate API to access the values which does not require the class to have the corresponding non-transient and non-static fields for each named serializable field. The serializable fields are those declared using <code class="cCode">serialPersistentFields</code> or if it is not declared the non-transient and non-static fields of the object. When the stream is read the available serializable fields are those written to the stream when the object was serialized. If the class that wrote the stream is a different version not all fields will correspond to the serializable fields of the current class. The available fields can be retrieved from the <code class="cCode">ObjectStreamClass</code> of the <code class="cCode">GetField</code> object.
</p>
<a name="wp5029"> </a><p class="pBody">
The <code class="cCode">getObjectStreamClass</code> method returns an <code class="cCode">ObjectStreamClass</code> object representing the class in the stream. It contains the list of serializable fields.
</p>
<a name="wp4941"> </a><p class="pBody">
The <code class="cCode">defaulted</code> method returns <em class="cEmphasis">true</em> if the field is not present in the stream. An <code class="cCode">IllegalArgumentException</code> is thrown if the requested field is not a serializable field of the current class.
</p>
<a name="wp4942"> </a><p class="pBody">
Each <code class="cCode">get</code> method returns the specified serializable field from the stream. I/O exceptions will be thrown if the underlying stream throws an exception. An <code class="cCode">IllegalArgumentException</code> is thrown if the name or type does not match the name and type of an field serializable field of the current class. The default value is returned if the stream does not contain an explicit value for the field.
</p>
<a name="wp3403"> </a><h2 class="pHeading1">
	1.3	The ObjectInputValidation Interface
</h2>
<a name="wp2942"> </a><p class="pBody">
	This interface allows an object to be called when a complete graph of objects has been deserialized. If the object cannot be made valid, it should throw the <code class="cCode">ObjectInvalidException</code>. Any exception that occurs during a call to <code class="cCode">validateObject</code> will terminate the validation process, and the <code class="cCode">InvalidObjectException</code> will be thrown.
</p>
<div class="pPreformatted"><pre class="pPreformatted">
package java.io;

public interface ObjectInputValidation
{    
	public void validateObject()        
		throws InvalidObjectException;
}<a name="wp2969"> </a>
</pre></div>
<a name="wp2971"> </a><h2 class="pHeading1">
	1.4	The readObject Method
</h2>
<a name="wp4567"> </a><p class="pBody">
For serializable objects, the <code class="cCode">readObject</code> method allows a class to control the deserialization of its own fields. Here is its signature:
</p>
<div class="pPreformatted"><pre class="pPreformatted">
private void readObject(ObjectInputStream stream)        
	throws IOException, ClassNotFoundException;<a name="wp1081"> </a>
</pre></div>
<a name="wp4580"> </a><p class="pBody">
Each subclass of a serializable object may define its own <code class="cCode">readObject</code> method. If a class does not implement the method, the default serialization provided by <code class="cCode">defaultReadObject</code> will be used. When implemented, the class is only responsible for restoring its own fields, not those of its supertypes or subtypes.
</p>
<a name="wp4581"> </a><p class="pBody">
The <code class="cCode">readObject</code> method of the class, if implemented, is responsible for restoring the state of the class. The values of every field of the object whether transient or not, static or not are set to the default value for the fields type. Either <code class="cCode">ObjectInputStream</code>&#8217;s <code class="cCode">d</code><code class="cCode">efaultReadObject</code> or <code class="cCode">readFields</code> method must be called once (and only once) before reading any optional data written by the corresponding <code class="cCode">writeObject</code> method; even if no optional data is read, <code class="cCode">defaultReadObject</code> or <code class="cCode">readFields</code> must still be invoked once.  If the <code class="cCode">readObject</code> method of the class attempts to read more data than is present in the optional part of the stream for this class, the stream will return <code class="cCode">-1</code> for bytewise reads, throw an <code class="cCode">EOFException</code> for primitive data reads (e.g., <code class="cCode">readInt</code>, <code class="cCode">readFloat</code>), or throw an <code class="cCode">OptionalDataException</code> with the <code class="cCode">eof</code> field set to <code class="cCode">true</code> for object reads.
</p>
<a name="wp6186"> </a><p class="pBody">
The responsibility for the format, structure, and versioning of the optional data lies completely with the class. The <code class="cCode">@serialData</code> javadoc tag within the javadoc comment for the <code class="cCode">readObject</code> method should be used to document the format and structure of the optional data.
</p>
<a name="wp6108"> </a><p class="pBody">
If the class being restored is not present in the stream being read, then its <code class="cCode">readObjectNoData</code> method, if defined, is invoked (instead of <code class="cCode">readObject</code>); otherwise, its fields are initialized to the appropriate default values.  For further detail, see section <a  href="input.html#wp6053">1.5</a>.
</p>
<a name="wp6109"> </a><p class="pBody">
Reading an object from the <code class="cCode">ObjectInputStream</code> is analogous to creating a new object. Just as a new object&#8217;s constructors are invoked in the order from the superclass to the subclass, an object being read from a stream is deserialized from superclass to subclass. The <code class="cCode">readObject</code> or <code class="cCode">readObjectNoData</code> method is called instead of the constructor for each <code class="cCode">Serializable</code> subclass during deserialization. 
</p>
<a name="wp6012"> </a><p class="pBody">
One last similarity between a constructor and a <code class="cCode">readObject</code> method is that both provide the opportunity to invoke a method on an object that is not fully constructed. Any overridable (neither private, static nor final) method called while an object is being constructed can potentially be overridden by a subclass. Methods called during the construction phase of an object are resolved by the actual type of the object, not the type currently being initialized by either its constructor or <code class="cCode">readObject</code>/<code class="cCode">readObjectNoData</code> method. Therefore, calling an overridable method from within a <code class="cCode">readObject</code> or <code class="cCode">readObjectNoData</code> method may result in the unintentional invocation of a subclass method before the superclass has been fully initialized.
</p>
<a name="wp6053"> </a><h2 class="pHeading1">
	1.5	The readObjectNoData Method
</h2>
<a name="wp6054"> </a><p class="pBody">
For serializable objects, the <code class="cCode">readObjectNoData</code> method allows a class to control the initialization of its own fields in the event that a subclass instance is deserialized and the serialization stream does not list the class in question as a superclass of the deserialized object.  This may occur in cases where the receiving party uses a different version of the deserialized instance&#8217;s class than the sending party, and the receiver&#8217;s version extends classes that are not extended by the sender&#8217;s version.  This may also occur if the serialization stream has been tampered; hence, <code class="cCode">readObjectNoData</code> is useful for initializing deserialized objects properly despite a &#8220;hostile&#8221; or incomplete source stream.
</p>
<div class="pPreformatted"><pre class="pPreformatted">
  private void readObjectNoData() throws ObjectStreamException;<a name="wp6068"> </a>
</pre></div>
<a name="wp6066"> </a><p class="pBody">
Each serializable class may define its own <code class="cCode">readObjectNoData</code> method.  If a serializable class does not define a <code class="cCode">readObjectNoData</code> method, then in the circumstances listed above the fields of the class will be initialized to their default values (as listed in section 4.5.5 of The Java&#8482; Language Specification, Second Edition); this behavior is consistent with that of <code class="cCode">ObjectInputStream</code> prior to version 1.4 of the Java&#8482; 2 SDK, Standard Edition, when support for <code class="cCode">readObjectNoData</code> methods was introduced.  If a serializable class does define a <code class="cCode">readObjectNoData</code> method and the aforementioned conditions arise, then <code class="cCode">readObjectNoData</code> will be invoked at the point during deserialization when a class-defined <code class="cCode">readObject</code> method would otherwise be called had the class in question been listed by the stream as a superclass of the instance being deserialized.
</p>
<a name="wp6014"> </a><h2 class="pHeading1">
	1.6	The readExternal Method
</h2>
<a name="wp5177"> </a><p class="pBody">
Objects implementing <code class="cCode">java.io.Externalizable</code> must implement the<code class="cCode"> readExternal</code> method to restore the entire state of the object. It must coordinate with its superclasses to restore their state. All of the methods of <code class="cCode">ObjectInput</code> are available to restore the object&#8217;s primitive typed fields and object fields.
</p>
<div class="pPreformatted"><pre class="pPreformatted">
    public void readExternal(ObjectInput stream)        
		throws IOException;<a name="wp3410"> </a>
</pre></div>
<hr class="pHr"/><div class="note">
<a name="wp1234"> </a>
<b>Note &#8211;</b>  The <code class="cCode">readExternal</code> method is public, and it raises the risk of a client being able to overwrite an existing object from a stream. The class may add its own checks to insure that this is only called when appropriate.
<hr class="pHr"/></note>
<a name="wp5238"> </a><p class="pBody">
A new stream protocol version has been introduced in JDK&#8482; 1.2 to correct a problem with <code class="cCode">Externalizable</code> objects. The old definition of <code class="cCode">Externalizable</code> objects required the local virtual machine to find a <code class="cCode">readExternal</code> method to be able to properly read an <code class="cCode">Externalizable</code> object from the stream. The new format adds enough information to the stream protocol so serialization can skip an <code class="cCode">Externalizable</code> object when the local <code class="cCode">readExternal</code> method is not available. Due to class evolution rules, serialization must be able to skip an <code class="cCode">Externalizable</code> object in the input stream if there is not a mapping for the object using the local classes. 
</p>
<a name="wp6050"> </a><p class="pBody">
An additional benefit of the new <code class="cCode">Externalizable</code> stream format is that <code class="cCode">ObjectInputStream</code> can detect attempts to read more External data than is available, and can also skip by any data that is left unconsumed by a <code class="cCode">readExternal</code> method.  The behavior of <code class="cCode">ObjectInputStream</code> in response to a read past the end of External data is the same as the behavior when a class-defined <code class="cCode">readObject</code> method attempts to read past the end of its optional data: bytewise reads will return <code class="cCode">-1</code>, primitive reads will throw <code class="cCode">EOFException</code>s, and object reads will throw <code class="cCode">OptionalDataException</code>s with the <code class="cCode">eof</code> field set to <code class="cCode">true</code>.
</p>
<a name="wp5325"> </a><p class="pBody">
Due to the format change, JDK&#8482; 1.1.6 and earlier releases are not able to read the new format. <code class="cCode">StreamCorruptedException</code> is thrown when JDK&#8482; 1.1.6 or earlier attempts to read an <code class="cCode">Externalizable</code> object from a stream written in <code class="cCode">PROTOCOL_VERSION_2</code>. Compatibility issues are discussed in more detail in <a  href="protocol.html#wp5849">Section&#160;6.3 &quot;Stream Protocol Versions</a>.&#8221;
</p>
<a name="wp5903"> </a><h2 class="pHeading1">
	1.7	The readResolve Method
</h2>
<a name="wp5904"> </a><p class="pBody">
For Serializable and Externalizable classes, the <code class="cCode">readResolve</code> method allows a class to replace/resolve the object read from the stream before it is returned to the caller. By implementing the <code class="cCode">readResolve</code> method, a class can directly control the types and instances of its own instances being deserialized. The method is defined as follows:
</p>
<div class="pPreformatted"><pre class="pPreformatted">
	ANY-ACCESS-MODIFIER Object readResolve()    		
		throws ObjectStreamException;<a name="wp5905"> </a>
</pre></div>
<a name="wp5906"> </a><p class="pBody">
The <code class="cCode">readResolve</code> method is called when <code class="cCode">ObjectInputStream</code> has read an object from the stream and is preparing to return it to the caller. <code class="cCode">ObjectInputStream</code> checks whether the class of the object defines the <code class="cCode">readResolve</code> method. If the method is defined, the <code class="cCode">readResolve</code> method is called to allow the object in the stream to designate the object to be returned. The object returned should be of a type that is compatible with all uses. If it is not compatible, a <code class="cCode">ClassCastException</code> will be thrown when the type mismatch is discovered.
</p>
<a name="wp5907"> </a><p class="pBody">
For example, a <code class="cCode">Symbol</code> class could be created for which only a single instance of each symbol binding existed within a virtual machine. The <code class="cCode">readResolve</code><code class="cCode"> </code>method would be implemented to determine if that symbol was already defined and substitute the preexisting equivalent <code class="cCode">Symbol</code> object to maintain the identity constraint. In this way the uniqueness of <code class="cCode">Symbol</code> objects can be maintained across serialization. 
</p>
<hr class="pHr"/><div class="note">
<a name="wp5981"> </a>
<b>Note &#8211;</b>  The <code class="cCode">readResolve</code> method is not invoked on the object until the object is fully constructed, so any references to this object in its object graph will not be updated to the new object nominated by <code class="cCode">readResolve</code>. However, during the serialization of an object with the <code class="cCode">writeReplace </code>method, all references to the original object in the replacement object&#8217;s object graph are replaced with references to the replacement object. Therefore in cases where an object being serialized nominates a replacement object whose object graph has a reference to the original object, deserialization will result in an incorrect graph of objects. Furthermore, if the reference types of the object being read (nominated by <code class="cCode">writeReplace</code>) and the original object are not compatible, the construction of the object graph will raise a <code class="cCode">ClassCastException</code>.
<hr class="pHr"/></note>

    <p>&#160;</p>
    <hr class="pHr" />
    <table width="100%" summary="layout">
      <tr><td align="left">
        <a accesskey="c" href="serialTOC.html">Contents</a> | 
	<a accesskey="p" href="output.html">Previous</a> | 
        <a accesskey="n" href="class.html">Next</a>
       </td>
        <td align="right">
          <span class="copyright">Java<font size="-2"><sup>TM</sup></font> Object Serialization Specification  </span>
        </td>
      </tr>
    </table>

    <p>&#160;</p>
    <p class="copyright"><a 
       href="copyright.html">Copyright</a> &#169;
       2003 Sun Microsystems, Inc. All rights reserved.</p>
  </body>
</html>
